<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>main page</title>

  <link rel="icon" href="./favicon.png">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&display=swap" rel="stylesheet">

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="/css/common.css">
  <link rel="stylesheet" href="/css/index.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"
    integrity="sha512-WFN04846sdKMIP5LKNphMaWzU7YpMyCU245etK3g/2ARYbPK9Ub18eG+ljU96qKRCWh+quCY7yefSmlkQw1ANQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"
    integrity="sha512-H6cPm97FAsgIKmlBA4s774vqoN24V5gSQL4yBTDOY2su2DeXZVhQPxFK4P6GPdnZqM9fg1G3cMv5wD7e6cFLZQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/ScrollToPlugin.min.js"
    integrity="sha512-agNfXmEo6F+qcj3WGryaRvl9X9wLMQORbTt5ACS9YVqzKDMzhRxY+xjgO45HCLm61OwHWR1Oblp4QSw/SGh9SA=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <link rel="stylesheet" href="https://unpkg.com/swiper@6.8.4/swiper-bundle.min.css" />
  <script src="https://unpkg.com/swiper@6.8.4/swiper-bundle.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.8/ScrollMagic.min.js"
    integrity="sha512-8E3KZoPoZCD+1dgfqhPbejQBnQfBXe8FuwL4z/c8sTrgeDMFEnoyTlH3obB4/fV+6Sg0a0XF+L/6xS4Xx1fUEg=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>


  <script defer src="/js/common.js"></script>
  <script defer src="/js/index.js"></script>
</head>

<body>

  <!-- HEADER -->
  <header>
    <div class="inner">

      <a href="/" class="logo">
        <img src="/img/logo.png" alt="STARBUCKS" width="50%">
      </a>

      <div class="sub-menu">
        <ul class="menu">
          <li>
            <a href="/login.html" id="userName">로그인을 해주세요!</a>
          </li>
          <li>
            <a href="/login.html" id="signin">Sign In</a>
          </li>
          <li>
            <a href="index.html" id="logout">Logout</a>
          </li>
        </ul>
        <div class="search">
          <input type="text">
          <div class="material-icons">search</div>
        </div>
      </div>

      <ul class="main-menu">
        <li class="item">
          <a href="/index.html">
            <div class="item__name glitch">홈</div>
          </a>
        </li>
        <li class="item">
          <a href="/project_list.html">
            <div class="item__name glitch">프로젝트 목록</div>
          </a>
        </li>
        <li class="item">
          <a href="/upload.html">
            <div class="item__name glitch">프로젝트 신청하기</div>
          </a>
        </li>
        <li class="item">
          <a href="/admin.html">
            <div class="item__name glitch">프로젝트 관리하기</div>
          </a>
        </li>
  </header>


  <!-- VISUAL -->
  <section class="visual">
    <div class="inner">
      <div class="title fade-in">
        <img src="/img/title.png" alt="title">

        <div class="fade-in">
          <img src="/img/title1.png" alt="title1" width="120%" class="title1">
          <a href="javascripts:void(0)" class="btn btn--white title1--btn">자세히 보기</a>
        </div>
        <div class="fade-in">
          <img src="/img/title2.png" alt="title2" width="180%" class="title2">
        </div>

      </div>
    </div>
  </section>



  <!-- 공지사항 -->
  <section class="notice">
    <!--NOTICE LINE-->
    <div class="notice-line">
      <div class="bg-left"></div>
      <div class="bg-right"></div>
      <div class="inner">
        <div class="inner__left">
          <h2>공지사항</h2>
          <div class="swiper-container">
            <div class="swiper-wrapper">
              <div class="swiper-slide">
                <a href="javascript:void(0)">사이트 정식 출시& 기념 이벤트</a>
              </div>
              <div class="swiper-slide">
                <a href="javascript:void(0)">고객관리 센터 운영시간 변경 안내</a>
              </div>
              <div class="swiper-slide">
                <a href="javascript:void(0)">애플리케이션 개발 안내</a>
              </div>
              <div class="swiper-slide">
                <a href="javascript:void(0)">신규 유저들을 위한 사이트 이용안내</a>
              </div>
            </div>
          </div>
          <a href="javascript:void(0)" class="notice-line__more">
            <span class="material-icons">add_circle</span>
          </a>
        </div>

        <div class="inner__right">
          <h2>신규 & 인기 게임 프로모션</h2>
          <div class="toggle-promotion open">
            <div class="material-icons">upload</div>
          </div>
        </div>

      </div>
    </div>

    <!-- 프로모션 -->
    <div class="promotion">
      <div class="swiper-container">
        <div class="swiper-wrapper">
          <div class="swiper-slide">
            <img src="" alt="Game1" id="prom_game1">
            <a href="javascriptvoid(0)" class="btn btn--blue">자세히 보기</a>
          </div>
          <div class="swiper-slide">
            <img src="" alt="Game2" id="prom_game2">
            <a href="javascriptvoid(0)" class="btn btn--blue">자세히 보기</a>
          </div>
          <div class="swiper-slide">
            <img src="" alt="Game3" id="prom_game3">
            <a href="javascriptvoid(0)" class="btn btn--blue">자세히 보기</a>
          </div>
          <div class="swiper-slide">
            <img src="" alt="Game4" id="prom_game4">
            <a href="javascriptvoid(0)" class="btn btn--blue">자세히 보기</a>
          </div>
          <div class="swiper-slide">
            <img src="" alt="Game5" id="prom_game5">
            <a href="javascriptvoid(0)" class="btn btn--blue">자세히 보기</a>
          </div>
        </div>
      </div>
      <div class="swiper-pagination"></div>
      <div class="swiper-prev">
        <div class="material-icons">arrow_back</div>
      </div>
      <div class="swiper-next">
        <div class="material-icons">arrow_forward</div>
      </div>
    </div>
  </section>



  <!-- 게임, 후원 목록 -->
  <section class="rewards">
    <div class="bg-left">
      <div class="bg-left-title">
        <!-- <h2 class="newlist" data-text="신규 프로젝트 목록">신규 프로젝트 목록</h2> -->
        <div class="glitch">
          <span aria-hidden="true">신규 프로젝트 목록</span>
          신규 프로젝트 목록
          <span aria-hidden="true">신규 프로젝트 목록</span>
        </div>
      </div>

      <div class="container">
        <!-- 게임 리스트 -->
      </div>

    </div>


    <div class="bg-right">

      <div class="bg-right-title">
        <div class="glitch">
          <span aria-hidden="true">신규 후원 목록</span>
          신규 후원 목록
          <span aria-hidden="true">신규 후원 목록</span>
        </div>
      </div>

      <div class="sup_list">
       
      </div>

    </div>



  </section>























  <!--FOOTER -->
  <footer>
    <div class="inner">

      <ul class="menu">
        <li><a href="javascript:void(0)" class="green">개인정보처리방침</a></li>
        <li><a href="javascript:void(0)">영상정보처리기기 운영관리 방침</a></li>
        <li><a href="javascript:void(0)">홈페이지 이용약관</a></li>
        <li><a href="javascript:void(0)">위치정보 이용약관</a></li>
        <li><a href="javascript:void(0)">윤리경영 핫라인</a></li>
      </ul>

      <div class="btn-group">
        <a href="javascript:void(0)" class="btn btn--white">찾아오시는 길</a>
        <a href="javascript:void(0)" class="btn btn--white">신규프로젝트제의</a>
        <a href="javascript:void(0)" class="btn btn--white">사이트 맵</a>
      </div>

      <div class="info">
        <span>사업자등록번호 xxx-xx-xxxxx</span>
        <span>(주)xxxx xxx xxxx xxx</span>
        <span>TEL : 02) xxxx-xxxx / FAX : 02) xxxx-xxxx</span>
        <span>개인정보 책임자 : xxx</span>
      </div>

      <p class="copyright">
        &copy; <span class="this-year"></span> 5조 하늘다람쥐. All Rights Reserved.
      </p>
      <!-- <img src="./images/starbucks_logo_only_text.png" alt="" class="logo"> -->

    </div>
  </footer>


  <div id="to-top">
    <div class="material-icons">arrow_upward</div>
  </div>





  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>

  <!-- JavaScript Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
    crossorigin="anonymous"></script>

  <script src="https://code.jquery.com/jquery-3.6.1.min.js"
    integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>

  <script>

    var firebaseConfig = {
      apiKey: "AIzaSyAjFDujRZbQxm5YY-ynFC5kiLNGzt6NcMI",
      authDomain: "cccc-2a18a.firebaseapp.com",
      projectId: "cccc-2a18a",
      storageBucket: "cccc-2a18a.appspot.com",
      messagingSenderId: "231950575405",
      appId: "1:231950575405:web:0320c24b35fbc2749215a4"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig)
  </script>

  <script>
    const db = firebase.firestore();
    const storage = firebase.storage();


    //로그인 한 유저 정보를 localStorage에 저장해두었기 때문에 거기서 탐색해 로그인 유무를 확인
    //먄약 로그인이 되어 있다면

    if (localStorage.getItem('user')) {
      var 뺀거 = localStorage.getItem('user');
      $('#userName').html(JSON.parse(뺀거).displayName + '님 환영합니다!');
      //로그인 상태에서 버튼 숨기기
      if (뺀거) {//로그인 한 상태
        $('#signin').hide();
        $('#logout').show();
      } else {
        $('#signin').show();
        $('#logout').hide();
      }
    }



    //로그아웃
    $('#logout').click(function () {
      firebase.auth().signOut().then(function () {
        // Sign-out successful.
        alert('로그아웃 되었습니다.');
        localStorage.removeItem('user');
        location.href = 'index.html';
      }).catch(function (error) {
        // An error happened.
        alert('로그아웃 실패');
      });
    });


    //프로모션 부분
    //storage에서 이미지 가져오기
    var storageRef = storage.ref();
    var spaceRef = storageRef.child('images/game1.png');
    spaceRef.getDownloadURL().then(function (url) {
      var img = document.getElementById('prom_game1');
      img.src = url;
    }).catch(function (error) {
      // Handle any errors
    });

    var storageRef = storage.ref();
    var spaceRef = storageRef.child('images/game2.png');
    spaceRef.getDownloadURL().then(function (url) {
      var img = document.getElementById('prom_game2');
      img.src = url;
    }).catch(function (error) {
      // Handle any errors
    });

    var storageRef = storage.ref();
    var spaceRef = storageRef.child('images/game3.png');
    spaceRef.getDownloadURL().then(function (url) {
      var img = document.getElementById('prom_game3');
      img.src = url;
    }).catch(function (error) {
      // Handle any errors
    });
    var storageRef = storage.ref();
    var spaceRef = storageRef.child('images/game4.png');
    spaceRef.getDownloadURL().then(function (url) {
      var img = document.getElementById('prom_game4');
      img.src = url;
    }).catch(function (error) {
      // Handle any errors
    });
    var storageRef = storage.ref();
    var spaceRef = storageRef.child('images/game5.png');
    spaceRef.getDownloadURL().then(function (url) {
      var img = document.getElementById('prom_game5');
      img.src = url;
    }).catch(function (error) {
      // Handle any errors
    });





    //게임의 목록을 출력하는 부분
    db.collection('game').get().then((결과) => {
      결과.forEach((doc) => {
        //달성률 = current_total_money / goal * 100
        var 달성률 = doc.data().current_total_money / doc.data().goal * 100;
        //달성률은 정수로 출력
        달성률 = parseInt(달성률);
        var 템플릿 =
          `
      <div class="card--list container-item">
        <div class="lines"></div>
        <div class="imgBx">
          <img src="${doc.data().image}" alt="">
        </div>
        <div class="content">
          <div class="details">
            <h2>
              <div class="glitch">
                ${doc.data().name}
              </div>
              <label>${doc.data().category}</label>
            </h2>
            <div class="data">
              <h3>${doc.data().sup} <br><span>후원 수</span></h3>
              <h3>${doc.data().foll} <br><span>Followers</span></h3>
            </div>
            <div class="container--percent">
              <div class="card">
                <div class="percent" style="--clr:#04fc43;--num:${달성률};">
                  <div class="dot"></div>
                  <svg>
                    <circle cx="70" cy="70" r="70"></circle>
                    <circle cx="70" cy="70" r="70"></circle>
                  </svg>
                  <div class="number">
                    <h2>${달성률}<span>%</span></h2>
                    <p>달성률</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="actionBtn ">
              <button onclick="location.href='/project_detail.html?id=${doc.id}'"> 자세히 보기</button>
            </div>
          </div>
        </div>
      </div>
                    `
          ;
        $('.container').append(템플릿);
      })
    })


    //game의 하위 컬렉션인 support들을 모두 출력
    db.collection('game').get().then((결과) => {
      결과.forEach((doc) => {
        
        //게임 이름 가져오기
        var 게임이름 = doc.data().name;
        //이미지 가져오기
        var 이미지 = doc.data().image;
        
        



        db.collection('game').doc(doc.id).collection('support').get().then((결과) => {
          결과.forEach((doc) => {

            var 템플릿 =
              `
              <div class="card--list container-item">
          <div class="lines"></div>
          <div class="imgBx">
            <img src="${이미지}" alt="">
          </div>
          <div class="content">
            <div class="details">
              <h2>
                <div class="glitch">
                  ${게임이름}
                </div>
                <label>후원자 명 : ${doc.data().sup_user[0]}</label>
              </h2>
              <div class="data">
                <span>후원 제목 : </span><span class="cont">${doc.data().sup_name}</span>
              </div>
  
              <div class="actionBtn ">
                <button> 자세히 보기</button>
              </div>
            </div>
          </div>
        </div>
              `
              ;
            $('.sup_list').append(템플릿);
          })
        })
      })
    })










  </script>



</body>

</html>